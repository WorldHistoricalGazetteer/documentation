<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SSH Key Setup &#8212; World Historical Gazetteer 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css?v=995e94df" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.min.css?v=21c0b90a" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=88135fc7" />
    <script src="../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Service Configuration" href="650-Service-Configuration.html" />
    <link rel="prev" title="System Architecture" href="500-System.html" />

   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  


<script defer data-domain="docs.whgazetteer.org" src="https://analytics.whgazetteer.org/js/script.hash.outbound-links.js"></script>
<script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>


  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="ssh-key-setup">
<h1>SSH Key Setup<a class="headerlink" href="#ssh-key-setup" title="Link to this heading">¶</a></h1>
<p>Here’s how to generate an SSH key, copy it to a remote server, and log in without relying on <code class="docutils literal notranslate"><span class="pre">PubkeyAuthentication</span></code> during the initial setup.</p>
<section id="generate-an-ssh-key">
<h2>1. Generate an SSH Key<a class="headerlink" href="#generate-an-ssh-key" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Open your terminal.</p></li>
<li><p>Run the following command, replacing <code class="docutils literal notranslate"><span class="pre">&quot;your_email&#64;example.com&quot;</span></code> with your email address and <code class="docutils literal notranslate"><span class="pre">/path/to/your/key</span></code> with the desired path and filename for your key (e.g., <code class="docutils literal notranslate"><span class="pre">~/.ssh/pitt</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>ed25519<span class="w"> </span>-C<span class="w"> </span><span class="s2">&quot;your_email@example.com&quot;</span><span class="w"> </span>-f<span class="w"> </span>/path/to/your/key
</pre></div>
</div>
</li>
<li><p>You’ll be prompted to enter a passphrase. You can leave it blank for no passphrase (not recommended for production).</p></li>
<li><p>This will create two files: <code class="docutils literal notranslate"><span class="pre">/path/to/your/key</span></code> (private key) and <code class="docutils literal notranslate"><span class="pre">/path/to/your/key.pub</span></code> (public key).</p></li>
</ul>
</section>
<section id="copy-the-public-key-to-the-remote-server">
<h2>2. Copy the Public Key to the Remote Server<a class="headerlink" href="#copy-the-public-key-to-the-remote-server" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">ssh-copy-id</span></code> command with the <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">PubkeyAuthentication=no</span></code> option to force password-based authentication during the key copy process. Replace <code class="docutils literal notranslate"><span class="pre">username</span></code> and <code class="docutils literal notranslate"><span class="pre">remote_host</span></code> with the appropriate values, and <code class="docutils literal notranslate"><span class="pre">/path/to/your/key.pub</span></code> with the path to your public key:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh-copy-id<span class="w"> </span>-i<span class="w"> </span>/path/to/your/key.pub<span class="w"> </span>-o<span class="w"> </span><span class="nv">PubkeyAuthentication</span><span class="o">=</span>no<span class="w"> </span>username@gazetteer.crcd.pitt.edu
</pre></div>
</div>
</li>
<li><p>You’ll be prompted for the remote server’s password.</p></li>
<li><p>This command adds your public key to the <code class="docutils literal notranslate"><span class="pre">~/.ssh/authorized_keys</span></code> file on the remote server.</p></li>
</ul>
</section>
<section id="log-in-to-the-remote-server">
<h2>3. Log in to the Remote Server<a class="headerlink" href="#log-in-to-the-remote-server" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Once the key is copied, you can log in using the following command, replacing <code class="docutils literal notranslate"><span class="pre">username</span></code> and <code class="docutils literal notranslate"><span class="pre">remote_host</span></code> with your values. The inclusion of <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">PubkeyAuthentication=no</span></code> is not needed for subsequent logins, only for the ssh-copy-id command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh<span class="w"> </span>-i<span class="w"> </span>/path/to/your/key<span class="w"> </span>username@gazetteer.crcd.pitt.edu
</pre></div>
</div>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">/path/to/your/key</span></code> can be omitted if you have only a few keys in your <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code> directory.</p></li>
<li><p>If you set a passphrase, you’ll be prompted to enter it. Otherwise, you’ll be logged in directly.</p></li>
<li><p>If you encounter a prompt regarding RedHat insights, that is normal, and is related to the operating system of the remote server.</p></li>
<li><p>You can simplify login by adding the following to your <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> file, following which you can log in with just <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">pitt</span></code>:</p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>Host pitt
    User username
    IdentityFile /path/to/your/key
    IdentitiesOnly yes
</pre></div>
</div>
</li>
</ul>
</section>
<section id="automatically-switch-to-the-gazetteer-account">
<h2>4. Automatically Switch to the <code class="docutils literal notranslate"><span class="pre">gazetteer</span></code> Account<a class="headerlink" href="#automatically-switch-to-the-gazetteer-account" title="Link to this heading">¶</a></h2>
<ul>
<li><p>After logging in, edit your <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> file using <code class="docutils literal notranslate"><span class="pre">vi</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>~/.bashrc
</pre></div>
</div>
</li>
<li><p><strong>Navigate to the end of the file:</strong> Press <code class="docutils literal notranslate"><span class="pre">G</span></code> (capital G).</p></li>
<li><p><strong>Navigate up one line:</strong> Press <code class="docutils literal notranslate"><span class="pre">k</span></code>. This ensures the new lines are inserted right before <code class="docutils literal notranslate"><span class="pre">unset</span> <span class="pre">rc</span></code>.</p></li>
<li><p><strong>Enter insert mode:</strong> Press <code class="docutils literal notranslate"><span class="pre">o</span></code> (lowercase o) to insert a new line below the current line.</p></li>
<li><p><strong>Add the following lines:</strong> Replace <code class="docutils literal notranslate"><span class="pre">username</span></code> with your actual username on the remote server.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Automatically switch to the gazetteer account on login</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$USER</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;username&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">$-</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*i*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>sudo<span class="w"> </span>su<span class="w"> </span>-<span class="w"> </span>gazetteer
<span class="k">fi</span>
</pre></div>
</div>
</li>
<li><p><strong>Exit insert mode:</strong> Press <code class="docutils literal notranslate"><span class="pre">Esc</span></code>.</p></li>
<li><p><strong>Save and exit:</strong> Type <code class="docutils literal notranslate"><span class="pre">:wq</span></code> and press Enter.</p></li>
<li><p>The next time you log in, you will be automatically switched to the <code class="docutils literal notranslate"><span class="pre">gazetteer</span></code> account.</p></li>
</ul>
</section>
<section id="check-kubernetes-nodes">
<h2>5. Check Kubernetes Nodes<a class="headerlink" href="#check-kubernetes-nodes" title="Link to this heading">¶</a></h2>
<ul>
<li><p>After logging in and being switched to the <code class="docutils literal notranslate"><span class="pre">gazetteer</span></code> account, run the following command to check the status of your Kubernetes nodes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</pre></div>
</div>
</li>
<li><p>This will display a list of nodes and their status. A <code class="docutils literal notranslate"><span class="pre">Ready</span></code> status indicates that the node is functioning correctly.</p></li>
<li><p>If Minikube is not running, the deployment script will automatically start it with the appropriate configuration (4 nodes, podman driver, etc.).</p></li>
</ul>
</section>
</section>
<section id="secrets-management">
<h1>Secrets Management<a class="headerlink" href="#secrets-management" title="Link to this heading">¶</a></h1>
<ul>
<li><p>Passwords and certificates for the Gazetteer services are stored in the private WHG <code class="docutils literal notranslate"><span class="pre">secrets</span></code> GitHub repository. These are retrieved automatically during the deployment process, but a GitHub <strong>Personal Access Token</strong> must first be set as an environment variable. See <a class="reference external" href="https://github.com/WorldHistoricalGazetteer/secrets?tab=readme-ov-file#setting-up-remote-programmatic-access">here</a> for instructions (you must be a member of the <em>World Historical Gazetteer</em> GitHub repository organization to do this).</p></li>
<li><p>Log in to the <code class="docutils literal notranslate"><span class="pre">gazetteer</span></code> service account on the VM, and add your <strong>Personal Access Token</strong> to the <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_TOKEN</span><span class="o">=</span>&lt;github-pat&gt;
</pre></div>
</div>
</li>
<li><p>After adding the token, run the following command to apply the changes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>~/.bashrc
</pre></div>
</div>
</li>
<li><p>A script will be run during the deployment process to bundle the variable into a Kubernetes secret, which will be used by the management pod to access the private repository.</p></li>
</ul>
</section>
<section id="deploying-the-management-pod">
<h1>Deploying the Management Pod<a class="headerlink" href="#deploying-the-management-pod" title="Link to this heading">¶</a></h1>
<p>The deployment script handles all setup automatically, including:</p>
<ul class="simple">
<li><p>Starting/verifying Minikube</p></li>
<li><p>Enabling required addons (dashboard, metrics-server)</p></li>
<li><p>Creating necessary secrets</p></li>
<li><p>Deploying the management Helm chart</p></li>
</ul>
<p>Run the deployment script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>&lt;<span class="o">(</span>curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;https://raw.githubusercontent.com/WorldHistoricalGazetteer/place/main/deployment/deploy.sh&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>The script may safely be re-run to update the deployment or apply any changes.</p>
</section>
<section id="accessing-kubernetes-dashboard-and-services-locally">
<h1>Accessing Kubernetes Dashboard and Services Locally<a class="headerlink" href="#accessing-kubernetes-dashboard-and-services-locally" title="Link to this heading">¶</a></h1>
<p>Download the tunnel setup script for forwarding the necessary ports to your local machine:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-s<span class="w"> </span>-o<span class="w"> </span>k8s-tunnel.sh<span class="w"> </span><span class="s2">&quot;https://raw.githubusercontent.com/WorldHistoricalGazetteer/place/main/deployment/k8s-tunnel.sh&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>k8s-tunnel.sh
</pre></div>
</div>
<p>Run the script to set up the kubectl proxy and SSH tunnel:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./k8s-tunnel.sh<span class="w"> </span>start
</pre></div>
</div>
<p>The script will:</p>
<ul class="simple">
<li><p>Request your remote SSH user name</p></li>
<li><p>Print a local port forwarding command which you will need to run in a separate LOCAL terminal window</p></li>
<li><p>List the services available and their local URLs, including the Kubernetes dashboard at http://localhost:8010/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/#/workloads?namespace=whg</p></li>
</ul>
<p>When you have finished, you can stop the proxy and tunnel on the remote machine by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./k8s-tunnel.sh<span class="w"> </span><span class="nb">kill</span>
</pre></div>
</div>
<p>To terminate the local port forwarding on your local machine, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pkill<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;ssh -fN -L&quot;</span>
</pre></div>
</div>
</section>
<section id="deploying-services">
<h1>Deploying Services<a class="headerlink" href="#deploying-services" title="Link to this heading">¶</a></h1>
<ul class="simple">
<li><p>Access the management API service by visiting <code class="docutils literal notranslate"><span class="pre">http://localhost:8010/api/v1/namespaces/whg/services/http:management-chart-service:8000/proxy/</span></code> in your browser.</p></li>
<li><p>To use the helm installation API, visit <code class="docutils literal notranslate"><span class="pre">http://localhost:8010/api/v1/namespaces/whg/services/http:management-chart-service:8000/proxy/install/&lt;chart-name&gt;</span></code> in your browser.</p></li>
</ul>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/whg_logo.png" alt="Logo of World Historical Gazetteer"/>
            </a></p>
<h1 class="logo"><a href="../index.html">World Historical Gazetteer</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="001-Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="001-Introduction.html#workbench-pathways">Workbench Pathways</a></li>
<li class="toctree-l1"><a class="reference internal" href="100-Tutorials.html">Tutorials &amp; Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="400-Technical.html">Technical</a></li>
<li class="toctree-l1"><a class="reference internal" href="500-System.html">System Architecture</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">SSH Key Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#generate-an-ssh-key">1. Generate an SSH Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="#copy-the-public-key-to-the-remote-server">2. Copy the Public Key to the Remote Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#log-in-to-the-remote-server">3. Log in to the Remote Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#automatically-switch-to-the-gazetteer-account">4. Automatically Switch to the <code class="docutils literal notranslate"><span class="pre">gazetteer</span></code> Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="#check-kubernetes-nodes">5. Check Kubernetes Nodes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#secrets-management">Secrets Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="#deploying-the-management-pod">Deploying the Management Pod</a></li>
<li class="toctree-l1"><a class="reference internal" href="#accessing-kubernetes-dashboard-and-services-locally">Accessing Kubernetes Dashboard and Services Locally</a></li>
<li class="toctree-l1"><a class="reference internal" href="#deploying-services">Deploying Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="650-Service-Configuration.html">Service Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="950-License.html">Licence</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="500-System.html" title="previous chapter">System Architecture</a></li>
      <li>Next: <a href="650-Service-Configuration.html" title="next chapter">Service Configuration</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, World Historical Gazetteer.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/content/600-Technical-Administration.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>